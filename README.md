# EECS545 Project: Classification of Moving Objects via Change Detection and XNOR Networks in Real Time

## Usage:
Compile FastestMCD using Visual Studio, and run it on a dataset to produce images and masks OR use the supplied ones we already ran it on.
```bash
cd <REPO ROOT>/fastMCD_output
$ ./fastMCD ../Data/streetlight.mp4 1
```

Run fastMCD output through XNOR Network-In-Network Classifier. This outputs a file of bounding box locations and object classifications for each frame.
```bash
$ cd <REPO ROOT>/XNOR-Net-PyTorch/CIFAR10
$ python3 main.py --cpu --pretrained models/nin_best_XNOR.pth.tar --multi_fastMCD ../../fastMCD_output/streetlight_results --label 1
```

Run fastMCD output through Resnet34 (requires download). This outputs a file of bounding box locations and object classifications for each frame.
```bash
$ cd <REPO ROOT>/XNOR-Net-PyTorch/PyTorch_CIFAR10
$ python3 cifar10_download.py
$ python3 cifar10_test.py --classifier resnet34 --fastMCD ../../fastMCD_output/streetlight_results --label 1
```

### Evaluation Scripts
After handlabeling frames and saving .xml files to a labels folder, update the paths in Data/xml_parser/bb_xml_parser.py. Then run:
```bash
$ python3 bb_xml_parser.py
```
Next, separate the labels txt file generated by the output of bb_xml_parser.py into individual frames by updating the file name in Data/classification_accuracy/get_frame_data.py and then running:
```bash
$ python3 get_frame_data.py
```
Note that YOLO labeled frames start with 'FPS' instead of our method's 'frame' in each BOUNDING_BOX text file. This will need to be updated on line 6 of get_frame_data.py. 

To then calculate the accuracy, IoU, precision, and recall metrics, update the paths in Data/classification_accuracy/classification_accuracy.py of the `GT_path` and `YOLO_path` variables to point to the directories of the get_frame_data.py outputs. Then run:
```bash
$ python3 classification_accuracy.py
```
#### Results of our method compared to Tiny YOLOv3 on the *streetlight* video
            **Our Method**              **Tiny YOLOv3**
FPS             14.03                       0.850
IoU             0.729                       0.029
Accuracy        71.63%                      43.36%
Precision       0.997                       0.999
Recall          0.878                       0.597

### MNIST Proof Of Concept
To use fastMCD with the xnor net, use the following basic procedure (use for MNIST case):

1) Build fastMCD:
```bash
    cd fastMCD
    mkdir build
    cd build
    cmake ..
    make
    mv fastMCD ../../fastMCD_output
```

2) Run fastMCD on number.m4v
```bash
    cd fastMCD_output
    ./fastMCD ../Data/number.m4v 1
```

3) Run xnor net on images
```bash
    cd XNOR-Net-PyTorch/MNIST
    python3 main.py --pretrained models/LeNet_5.best.pth.tar --fastMCD ../fastMCD_output/results/
```

